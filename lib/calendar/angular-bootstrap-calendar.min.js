"use strict";angular.module("mwl.calendar",["ui.bootstrap"]),angular.module("mwl.calendar").run(["$templateCache",function(e){e.put("templates/day.html",'<div class="cal-day-box"><div class="row-fluid clearfix cal-row-head"><div class="span1 col-xs-1 cal-cell">Time</div><div class="span11 col-xs-11 cal-cell">Events</div></div><div class="cal-day-panel" style="height: 960px;"><div class="cal-day-panel-hour"><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>06:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>06:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>07:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>07:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>08:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>08:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>09:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>09:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>10:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>10:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>11:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>11:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>12:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>12:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>13:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>13:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>14:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>14:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>15:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>15:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>16:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>16:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>17:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>17:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>18:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>18:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>19:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>19:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>20:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>20:30</b></div><div class="span11 col-xs-11"></div></div></div><div class="cal-day-hour"><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>21:00</b></div><div class="span11 col-xs-11"></div></div><div class="row-fluid cal-day-hour-part"><div class="span1 col-xs-1"><b>21:30</b></div><div class="span11 col-xs-11"></div></div></div></div><div class="pull-left day-event day-highlight dh-event-{{ event.type }}" ng-repeat="event in view track by $index" ng-style="{top: event.top + \'px\', left: event.left + 60 + \'px\', height: event.height + \'px\'}"><a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})"><span>{{ event.title | truncateEventTitle:20:event.height }}</span></a></div></div></div>'),e.put("templates/main.html",'<div class="cal-context" style="width: 100%;"><mwl-calendar-year calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" calendar-edit-event-click="eventEditClick" calendar-delete-event-click="eventDeleteClick" calendar-edit-event-html="editEventHtml" calendar-delete-event-html="deleteEventHtml" calendar-auto-open="autoOpen" ng-if="view == \'year\'"></mwl-calendar-year><mwl-calendar-month calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" calendar-edit-event-click="eventEditClick" calendar-delete-event-click="eventDeleteClick" calendar-edit-event-html="editEventHtml" calendar-delete-event-html="deleteEventHtml" calendar-auto-open="autoOpen" ng-if="view == \'month\'"></mwl-calendar-month><mwl-calendar-week calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" ng-if="view == \'week\'"></mwl-calendar-week><mwl-calendar-day calendar-events="events" calendar-current-day="currentDay" calendar-event-click="eventClick" ng-if="view == \'day\'"></mwl-calendar-day></div>'),e.put("templates/month.html",'<div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="day in weekDays">{{ day }}</div></div><div class="cal-month-box"><div ng-repeat="week in view track by $index"><div class="cal-row-fluid cal-before-eventlist"><div class="cal-cell1 cal-cell {{ day.highlightClass }}" ng-repeat="day in week track by $index" ng-click="dayClicked($parent.$index, $index)" ng-class="{pointer: day.events.length > 0}"><div class="cal-month-day" ng-class="{\'cal-day-outmonth\': !day.inMonth, \'cal-day-inmonth\': day.inMonth, \'cal-day-weekend\': $index == 5 || $index == 6, \'cal-day-today\': day.isToday}"><span class="pull-right" data-cal-date="" ng-click="drillDown(day.label)">{{ day.label }}</span><div class="cal-day-tick" ng-show="day.isOpened"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div><div class="events-list" ng-show="day.events.length > 0"><a href="javascript:;" ng-click="eventClick({$event: event})" ng-repeat="event in day.events track by $index" class="pull-left event event-{{ event.type }}" ng-mouseenter="highlightEvent(event, true)" ng-mouseleave="highlightEvent(event, false)" tooltip-append-to-body="true" tooltip="{{ event.title }}"></a></div></div></div></div><div class="cal-slide-box" collapse="!week.isOpened"><div class="cal-slide-content cal-event-list"><ul class="unstyled list-unstyled"><li ng-repeat="event in openEvents track by $index"><span class="pull-left event event-{{ event.type }}"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})">{{ event.title }}</a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="$sce.trustAsHtml(editEventHtml)" ng-click="eventEditClick({$event: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="$sce.trustAsHtml(deleteEventHtml)" ng-click="eventDeleteClick({$event: event})"></a></li></ul></div></div></div></div>'),e.put("templates/week.html",'<div class="cal-week-box"><div class="cal-row-fluid cal-row-head"><div class="cal-cell1" ng-repeat="column in view.columns track by $index" ng-class="{\'cal-day-weekend\': $index > 4, \'cal-day-today\': column.isToday}">{{ column.weekDay }}<br><small><span data-cal-date="" ng-click="drillDown(column.day)" class="pointer">{{ column.date }}</span></small></div></div><hr><div class="cal-row-fluid" ng-repeat="event in view.events track by $index"><div class="cal-cell{{ event.daySpan }} cal-offset{{ event.dayOffset }} day-highlight dh-event-{{ event.type }}" data-event-class=""><a href="javascript:;" ng-click="eventClick({$event: event})" class="cal-event-week">{{ event.title }}</a></div></div></div>'),e.put("templates/year.html",'<div class="cal-year-box"><div ng-repeat="year in view track by $index"><div class="row cal-before-eventlist"><div class="span3 col-md-3 col-xs-6 cal-cell" ng-repeat="month in year track by $index" ng-click="monthClicked($parent.$index, $index)" ng-class="{pointer: month.events.length > 0, \'cal-day-today\': month.isToday}"><span class="pull-right" data-cal-date="" ng-click="drillDown(month.monthIndex)">{{ month.label }}</span> <small class="cal-events-num badge badge-important pull-left" ng-show="month.events.length > 0">{{ month.events.length }}</small><div class="cal-day-tick" ng-show="month.isOpened"><i class="glyphicon glyphicon-chevron-up"></i> <i class="fa fa-chevron-up"></i></div></div></div><div class="cal-slide-box" collapse="!year.isOpened"><span class="cal-slide-tick"></span><div class="cal-slide-content"><ul class="unstyled list-unstyled"><li ng-repeat="event in openEvents track by $index"><span class="pull-left event" ng-class="\'event-\' + event.type"></span> &nbsp; <a href="javascript:;" class="event-item" ng-click="eventClick({$event: event})">{{ event.title }}</a> <a href="javascript:;" class="event-item-edit" ng-if="editEventHtml && event.editable !== false" ng-bind-html="$sce.trustAsHtml(editEventHtml)" ng-click="eventEditClick({$event: event})"></a> <a href="javascript:;" class="event-item-delete" ng-if="deleteEventHtml && event.deletable !== false" ng-bind-html="$sce.trustAsHtml(deleteEventHtml)" ng-click="eventDeleteClick({$event: event})"></a></li></ul></div></div></div></div>')}]),angular.module("mwl.calendar").constant("moment",window.moment),angular.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,a){var t=this;this.getMonthNames=function(a){for(var t=a?"MMM":"MMMM",n=[],l=0;11>=l;l++)n.push(e("date")(new Date(2014,l),t));return n},this.getWeekDayNames=function(a){for(var t=a?"EEE":"EEEE",n=[],l=0;6>=l;l++)n.push(e("date")(new Date(2014,8,22+l),t));return n},this.eventIsInPeriod=function(e,t,n,l){return a(e).isAfter(a(n))&&a(e).isBefore(a(l))||a(t).isAfter(a(n))&&a(t).isBefore(a(l))||a(e).isBefore(a(n))&&a(t).isAfter(a(l))||a(e).isSame(a(n))||a(t).isSame(a(l))},this.getYearView=function(e,n){for(var l=[],i=t.getMonthNames(),s=0;3>s;s++){for(var d=[],c=0;4>c;c++){var r=12-i.length,v=new Date(a(n).format("YYYY"),r,1),o=a(v).add(1,"month").subtract(1,"second").toDate();d.push({label:i.shift(),monthIndex:r,isToday:a(v).startOf("month").isSame(a().startOf("month")),events:e.filter(function(e){return t.eventIsInPeriod(e.starts_at,e.ends_at,v,o)})})}l.push(d)}return l},this.getMonthView=function(e,n){function l(){var e=i.day()-1;return 0>e&&(e=6),e}for(var i=a(n).startOf("month"),s=a(n).endOf("month").date(),d=[],c=new Array(7),r=e.map(function(e,a){return e.$id=a,e}),v=1;s>=v;v++){if(1==v)for(var o=l(i),u=i.clone();o>0;)o--,u=u.subtract(1,"day"),c[o]={label:u.date(),date:u.clone(),inMonth:!1,events:[]};if(c[l(i)]={label:i.date(),inMonth:!0,isToday:a().startOf("day").isSame(i),date:i.clone(),events:r.filter(function(e){return t.eventIsInPeriod(e.starts_at,e.ends_at,i.clone().startOf("day"),i.clone().endOf("day"))})},v==s)for(var o=l(i),p=i.clone();6>o;)o++,p=p.add(1,"day"),c[o]={label:p.date(),date:p.clone(),inMonth:!1,events:[]};(6===l(i)||v==s)&&(d.push(c),c=new Array(7)),i=i.add(1,"day")}return d},this.getWeekView=function(n,l){for(var i,s,d=new Array(7),c=t.getWeekDayNames(),r=l.getDay(),v=r;v>=0;v--){var o=a(l).subtract(r-v,"days").add(1,"day").toDate();d[v]={weekDay:c[v],day:e("date")(o,"d"),date:e("date")(o,"d MMM"),isToday:a(o).startOf("day").isSame(a().startOf("day"))},0==v?i=o:6==v&&(s=o)}for(var v=r+1;7>v;v++){var o=a(l).add(v-r,"days").add(1,"day").toDate();d[v]={weekDay:c[v],day:e("date")(o,"d"),date:e("date")(o,"d MMM"),isToday:a(o).startOf("day").isSame(a().startOf("day"))},0==v?i=o:6==v&&(s=o)}s=a(s).add(1,"day").subtract(1,"second").toDate();var u=n.filter(function(e){return t.eventIsInPeriod(e.starts_at,e.ends_at,i,s)}).map(function(e){var t=a(e.ends_at).startOf("day").diff(a(e.starts_at).startOf("day"),"days")+1;t>=7&&(t=7,a(e.ends_at).startOf("day").diff(a(s).startOf("day"),"days")<0&&(t+=a(e.ends_at).startOf("day").diff(a(s).startOf("day"),"days")+1));var n=a(e.starts_at).startOf("day").diff(a(i).startOf("day"),"days");return 0>n&&(n=0),n>6&&(n=6),t-n>0&&(t-=n),e.daySpan=t,e.dayOffset=n,e});return{columns:d,events:u}},this.getDayView=function(e,n){var l=a(n).startOf("day").add(6,"hours"),i=a(n).startOf("day").add(22,"hours"),s=960,d=[];return e.filter(function(e){return t.eventIsInPeriod(e.starts_at,e.ends_at,a(n).startOf("day").toDate(),a(n).endOf("day").toDate())}).map(function(e){if(e.top=a(e.starts_at).isBefore(l)?0:a(e.starts_at).startOf("minute").diff(l.startOf("minute"),"minutes")-2,a(e.ends_at).isAfter(i))e.height=s-e.top;else{var t=e.starts_at;a(e.starts_at).isBefore(l)&&(t=l.toDate()),e.height=a(e.ends_at).diff(t,"minutes")}return e.top-e.height>s&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var a=!0;return d.forEach(function(n,l){var i=!0;n.forEach(function(a){(t.eventIsInPeriod(e.starts_at,e.ends_at,a.starts_at,a.ends_at)||t.eventIsInPeriod(a.starts_at,a.ends_at,e.starts_at,e.ends_at))&&(i=!1)}),i&&a&&(a=!1,e.left=150*l,d[l].push(e))}),a&&(e.left=150*d.length,d.push([e])),e})},this.toggleEventBreakdown=function(e,a,t){var n=[];if(e[a][t].events.length>0){var l=e[a][t].isOpened;e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})}),e[a][t].isOpened=!l,e[a].isOpened=!l,n=e[a][t].events}return{view:e,openEvents:n}}}]),angular.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,a,t){return e?e.length>=a&&e.length/20>t/30?e.substr(0,a)+"...":e:""}}),angular.module("mwl.calendar").directive("mwlCalendarYear",["$sce","$timeout","calendarHelper","moment",function(e,a,t,n){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},link:function(l,i,s,d){function c(){l.view=t.getYearView(l.events,l.currentDay),l.autoOpen&&!r&&l.view.forEach(function(e,t){e.forEach(function(e,i){e.label==n(l.currentDay).format("MMMM")&&(l.monthClicked(t,i),a(function(){r=!1}))})})}var r=!1;l.$sce=e,d.titleFunctions.year=function(e){return n(e).format("YYYY")},l.$watch("currentDay",c),l.$watch("events",c,!0),l.monthClicked=function(e,a){var n=t.toggleEventBreakdown(l.view,e,a);l.view=n.view,l.openEvents=n.openEvents},l.drillDown=function(e){d.changeView("month",n(l.currentDay).clone().month(e).toDate())}}}}]),angular.module("mwl.calendar").directive("mwlCalendarWeek",["moment","calendarHelper",function(e,a){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick"},link:function(t,n,l,i){function s(){t.view=a.getWeekView(t.events,t.currentDay)}i.titleFunctions.week=function(a){return"Week "+e(a).week()+" of "+e(a).format("YYYY")},t.drillDown=function(a){i.changeView("day",e(t.currentDay).clone().date(a).toDate())},t.$watch("currentDay",s),t.$watch("events",s,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendarMonth",["$sce","$timeout","calendarHelper",function(e,a,t){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},link:function(n,l,i,s){function d(){n.view=t.getMonthView(n.events,n.currentDay),n.autoOpen&&!c&&n.view.forEach(function(e,t){e.forEach(function(e,l){e.inMonth&&moment(n.currentDay).startOf("day").isSame(e.date.startOf("day"))&&(n.dayClicked(t,l),a(function(){c=!1}))})})}var c=!1;n.$sce=e,s.titleFunctions.month=function(e){return moment(e).format("MMMM YYYY")},n.$watch("currentDay",d),n.$watch("events",d,!0),n.weekDays=t.getWeekDayNames(),n.dayClicked=function(e,a){var l=t.toggleEventBreakdown(n.view,e,a);n.view=l.view,n.openEvents=l.openEvents},n.drillDown=function(e){s.changeView("day",moment(n.currentDay).clone().date(e).toDate())},n.highlightEvent=function(e,a){n.view=n.view.map(function(t){return t.isOpened=!1,t.map(function(t){if(delete t.highlightClass,t.isOpened=!1,a){var n=t.events.filter(function(a){return a.$id==e.$id}).length>0;n&&(t.highlightClass="day-highlight dh-event-"+e.type)}return t})})}}}}]),angular.module("mwl.calendar").directive("mwlCalendarDay",["calendarHelper",function(e){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick"},link:function(a,t,n,l){function i(){a.view=e.getDayView(a.events,a.currentDay)}l.titleFunctions.day=function(e){return moment(e).format("dddd DD MMMM, YYYY")},a.$watch("currentDay",i),a.$watch("events",i,!0)}}}]),angular.module("mwl.calendar").directive("mwlCalendar",["moment",function(e){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen"},controller:["$scope",function(a){var t=this;this.titleFunctions={},this.changeView=function(e,t){a.view=e,a.currentDay=t},a.control=a.control||{},a.control.prev=function(){a.currentDay=e(a.currentDay).subtract(1,a.view).toDate()},a.control.next=function(){a.currentDay=e(a.currentDay).add(1,a.view).toDate()},a.control.getTitle=function(){return t.titleFunctions[a.view]?t.titleFunctions[a.view](a.currentDay):""}}]}}]);
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map